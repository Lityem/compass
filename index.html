<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Advanced Political Compass Test</title>
  <style>
    :root {
      --primary-color: #4f46e5;
      --secondary-color: #06b6d4;
      --accent-color: #10b981;
      --bg-color: #f8fafc;
      --text-color: #1e293b;

      --radius: 1rem;
      --shadow: 0 10px 25px rgba(0,0,0,0.1);
      --timing: 500ms;
      --timing-fast: 280ms;
      --stagger: 70ms;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      padding: 2rem;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 3rem 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    h1 {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
      text-align: center;
    }

    .subhead {
      text-align: center;
      opacity: .8;
      margin-bottom: 1.25rem;
    }

    /* Progress */
    .progress-wrap {
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, #fff, rgba(255,255,255,0.7));
      padding: .75rem 0 1rem;
      z-index: 5;
    }
    .progress {
      height: 10px;
      width: 100%;
      background: #e2e8f0;
      border-radius: 999px;
      overflow: hidden;
    }
    .progress__bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      transition: width var(--timing) ease;
    }
    .progress__label {
      margin-top: .5rem;
      font-size: .95rem;
      text-align: center;
      color: #475569;
    }

    .section-title {
      text-align: center;
      font-size: 1.75rem;
      font-weight: bold;
      color: var(--secondary-color);
      margin: 1.5rem 0 1rem;
    }

    .question {
      margin-bottom: 1.25rem;
      padding: 1.25rem;
      border-left: 4px solid var(--secondary-color);
      background: #f1f5f9;
      border-radius: 0.75rem;
      text-align: center;
      /* Staggered entrance */
      opacity: 0;
      transform: translateY(12px);
      animation: slideUp var(--timing) cubic-bezier(.22,.8,.36,1) forwards;
      animation-delay: calc(var(--i) * var(--stagger));
    }

    .question p {
      font-weight: 600;
      margin-bottom: .75rem;
    }

    .choices {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: .5rem 1rem;
    }
    .choices label {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .5rem .75rem;
      border-radius: 999px;
      background: #fff;
      border: 1px solid #cbd5e1;
      cursor: pointer;
      transition: transform var(--timing-fast) ease, box-shadow var(--timing-fast) ease, border-color var(--timing-fast) ease;
    }
    .choices input[type="radio"] { accent-color: var(--primary-color); }
    .choices label:hover { transform: translateY(-2px); box-shadow: 0 6px 14px rgba(0,0,0,.06); }

    .btns { text-align:center; margin-top: 1rem; }
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 0.75rem;
      cursor: pointer;
      margin: .5rem;
      transition: transform var(--timing-fast) ease, background-color var(--timing-fast) ease, box-shadow var(--timing-fast) ease;
      box-shadow: 0 8px 18px rgba(79,70,229,.25);
    }
    button:hover { background-color: #4338ca; transform: translateY(-1px); box-shadow: 0 10px 22px rgba(79,70,229,.28); }
    button:active { transform: translateY(0); }

    canvas {
      display: block;
      margin: 2rem auto 0;
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .hidden { display: none !important; }

    /* Section transitions */
    .fade-in { animation: fadeIn var(--timing) ease both; }
    .fade-out { animation: fadeOut var(--timing-fast) ease both; }

    /* Toast for validation */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      background: #0f172a;
      color: #fff;
      padding: .75rem 1rem;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,.25);
      opacity: 0;
      pointer-events: none;
      z-index: 999;
      animation: toastIn 300ms ease forwards;
    }

    /* Motion */
    @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
    @keyframes fadeOut { from { opacity: 1 } to { opacity: 0 } }
    @keyframes toastIn { to { opacity: 1; } }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>
  <div class="container" id="container">
    <h1>Advanced Political Compass Test</h1>
    <p class="subhead">Smooth transitions. Cleaner vibes. Same spicy questions.</p>

    <div class="progress-wrap" aria-hidden="false">
      <div class="progress" aria-label="Progress">
        <div class="progress__bar" id="progressBar"></div>
      </div>
      <div class="progress__label" id="progressLabel">Section 1 of 6</div>
    </div>

    <form id="quizForm" class="fade-in" aria-live="polite"></form>

    <div class="btns">
      <button id="nextBtn">Next Section</button>
      <button id="submitBtn" class="hidden" style="background: var(--accent-color)">Submit</button>
    </div>

    <canvas id="compassChart" width="500" height="500" class="hidden" aria-label="Political Compass Plot"></canvas>
  </div>

  <div id="toast" class="toast hidden" role="status">Please answer all questions in this section.</div>

  <script>
    const sections = [
      { axis: "economic", title: "Economic Section" },
      { axis: "social", title: "Social Section" },
      { axis: "culture", title: "Cultural Section" },
      { axis: "environment", title: "Environmental Section" },
      { axis: "globalism", title: "Globalism Section" },
      { axis: "techno", title: "Technocracy & Science Section" }
    ];

    // Original questions (unchanged), we'll assign IDs programmatically
    const baseQuestions = [
      // ECONOMIC
      { text: "The government should provide free healthcare for everyone.", axis: "economic", weight: -2 },
      { text: "Taxes on the wealthy should be significantly increased.", axis: "economic", weight: -2 },
      { text: "Privatization improves efficiency in essential services.", axis: "economic", weight: 2 },
      { text: "Corporations should have minimal regulations.", axis: "economic", weight: 2 },
      { text: "A universal basic income would solve many problems.", axis: "economic", weight: -2 },
      { text: "Unions are essential for protecting workersâ€™ rights.", axis: "economic", weight: -2 },
      { text: "Wealth should be redistributed through taxation.", axis: "economic", weight: -2 },
      { text: "Minimum wage laws hurt the economy.", axis: "economic", weight: 2 },
      { text: "Inheritance tax is necessary to reduce inequality.", axis: "economic", weight: -2 },
      { text: "Capitalism is fundamentally exploitative.", axis: "economic", weight: -2 },

      // SOCIAL
      { text: "Drug use should be decriminalized.", axis: "social", weight: -2 },
      { text: "The government should increase surveillance to combat threats.", axis: "social", weight: 2 },
      { text: "People should be allowed to protest freely, even during emergencies.", axis: "social", weight: -2 },
      { text: "The death penalty should be abolished.", axis: "social", weight: -2 },
      { text: "Children should be taught obedience and discipline above all.", axis: "social", weight: 2 },
      { text: "The state must maintain law and order above all.", axis: "social", weight: 2 },
      { text: "Censorship is sometimes necessary.", axis: "social", weight: 2 },
      { text: "Security is more important than civil liberties.", axis: "social", weight: 2 },
      { text: "The police should be demilitarized.", axis: "social", weight: -2 },
      { text: "Whistleblowers like Edward Snowden are heroes.", axis: "social", weight: -2 },

      // CULTURE
      { text: "Religious values should influence laws.", axis: "culture", weight: 2 },
      { text: "Same-sex marriage should be legal everywhere.", axis: "culture", weight: -2 },
      { text: "Trans people should be able to transition without restriction.", axis: "culture", weight: -2 },
      { text: "Abortion should be heavily restricted.", axis: "culture", weight: 2 },
      { text: "Traditional gender roles should be preserved.", axis: "culture", weight: 2 },
      { text: "Religious education should be part of the school curriculum.", axis: "culture", weight: 2 },
      { text: "Art should be free from political and religious censorship.", axis: "culture", weight: -2 },
      { text: "Religious symbols should be allowed in public institutions.", axis: "culture", weight: 1 },
      { text: "LGBTQ+ rights should be constitutionally protected.", axis: "culture", weight: -2 },

      // ENVIRONMENT
      { text: "Climate change is a major threat and needs urgent action.", axis: "environment", weight: -2 },
      { text: "Nuclear energy is a good solution to environmental problems.", axis: "environment", weight: 1 },
      { text: "Carbon taxes should be implemented globally.", axis: "environment", weight: -2 },
      { text: "Environmental regulations harm the economy too much.", axis: "environment", weight: 2 },
      { text: "We should stop eating meat to reduce environmental damage.", axis: "environment", weight: -2 },
      { text: "The government should subsidize electric cars.", axis: "environment", weight: -2 },
      { text: "Fossil fuels are still essential to our economy.", axis: "environment", weight: 2 },
      { text: "Climate change is exaggerated by activists.", axis: "environment", weight: 2 },
      { text: "We shouldn't sacrifice economic growth for environmental policies.", axis: "environment", weight: 2 },
      { text: "Protecting biodiversity is more important than expanding cities.", axis: "environment", weight: -2 },

      // GLOBALISM
      { text: "Borders should be open for free movement of people.", axis: "globalism", weight: -2 },
      { text: "We should prioritize national interest over global cooperation.", axis: "globalism", weight: 2 },
      { text: "The UN should have more authority over world affairs.", axis: "globalism", weight: -2 },
      { text: "Foreign aid should be drastically reduced.", axis: "globalism", weight: 2 },
      { text: "Multinational trade agreements help the world prosper.", axis: "globalism", weight: -2 },
      { text: "Immigrants should assimilate fully into the dominant culture.", axis: "globalism", weight: 2 },
      { text: "Refugees should be welcomed regardless of origin.", axis: "globalism", weight: -2 },
      { text: "Patriotism is a virtue.", axis: "globalism", weight: 2 },
      { text: "National identity must be preserved.", axis: "globalism", weight: 2 },
      { text: "A global government is desirable.", axis: "globalism", weight: -2 },

      // TECHNO
      { text: "Important decisions should be made by experts, not politicians.", axis: "techno", weight: -2 },
      { text: "Science should be the main basis for all policy decisions.", axis: "techno", weight: -2 },
      { text: "The voice of ordinary people matters more than experts.", axis: "techno", weight: 2 },
      { text: "Artificial intelligence should play a major role in governance.", axis: "techno", weight: -2 },
      { text: "Referendums are a better form of democracy than parliaments.", axis: "techno", weight: 2 },
      { text: "Scientific literacy should be required for politicians.", axis: "techno", weight: -2 },
      { text: "The elite cannot be trusted to govern fairly.", axis: "techno", weight: 2 },
      { text: "Conspiracy theories often have some truth.", axis: "techno", weight: 2 },
      { text: "We should listen more to academics than influencers.", axis: "techno", weight: -2 },
      { text: "Populist movements reflect legitimate concerns.", axis: "techno", weight: 1 }
    ];

    // Add IDs to questions for reliable grouping/answers
    const questions = baseQuestions.map((q, i) => ({ ...q, id: `q${i}` }));

    const form = document.getElementById('quizForm');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const progressBar = document.getElementById('progressBar');
    const progressLabel = document.getElementById('progressLabel');
    const container = document.getElementById('container');
    const toast = document.getElementById('toast');

    const answers = {}; // id -> 1..5
    let currentSection = 0;

    // For animated compass
    let lastPoint = { x: 0, y: 0 };

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 1800);
    }

    function updateProgress() {
      const total = sections.length;
      const current = currentSection + 1;
      const pct = (current / total) * 100;
      progressBar.style.width = pct + '%';
      progressLabel.textContent = `Section ${current} of ${total}`;
    }

    function scrollToTop() {
      // Smooth scroll to the very top of the page
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function renderSection() {
      form.innerHTML = '';
      form.classList.remove('fade-out');
      form.classList.add('fade-in');

      const { axis, title } = sections[currentSection];
      const sectionQuestions = questions.filter(q => q.axis === axis);

      const titleDiv = document.createElement('div');
      titleDiv.className = 'section-title';
      titleDiv.textContent = title;
      form.appendChild(titleDiv);

      sectionQuestions.forEach((q, idx) => {
        const div = document.createElement('div');
        div.className = 'question';
        div.style.setProperty('--i', idx);
        div.innerHTML = `<p>${q.text}</p><div class="choices" role="radiogroup" aria-label="${q.text}"></div>`;

        const choicesDiv = div.querySelector('.choices');
        const choices = ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'];

        choices.forEach((choice, i) => {
          const value = i + 1;
          const checked = answers[q.id] === value ? 'checked' : '';
          const inputId = `${q.id}_${value}`;
          choicesDiv.insertAdjacentHTML('beforeend', `
            <label for="${inputId}">
              <input type="radio" id="${inputId}" name="${q.id}" value="${value}" ${checked} required aria-required="true">
              ${choice}
            </label>
          `);
        });

        form.appendChild(div);
      });

      // Toggle buttons
      nextBtn.classList.toggle('hidden', currentSection === sections.length - 1);
      submitBtn.classList.toggle('hidden', currentSection !== sections.length - 1);

      updateProgress();
    }

    function captureAnswersInSection() {
      const inputs = form.querySelectorAll('input[type="radio"]:checked');
      inputs.forEach(input => {
        answers[input.name] = parseInt(input.value, 10);
      });
    }

    function sectionTransition(next) {
      // fade out, swap, fade in
      form.classList.remove('fade-in');
      form.classList.add('fade-out');

      // After fade-out, render next section and scroll to top
      setTimeout(() => {
        currentSection = next;
        renderSection();
        scrollToTop();
      }, 260);
    }

    nextBtn.addEventListener('click', (e) => {
      e.preventDefault();
      if (!form.checkValidity()) {
        showToast("Please answer all questions in this section.");
        // Trigger a subtle shake by toggling fade
        form.classList.remove('fade-in');
        void form.offsetWidth; // reflow
        form.classList.add('fade-in');
        return;
      }
      captureAnswersInSection();
      sectionTransition(currentSection + 1);
    });

    submitBtn.addEventListener('click', (e) => {
      e.preventDefault();
      if (!form.checkValidity()) {
        showToast("Please answer all questions.");
        return;
      }
      captureAnswersInSection();

      // Compute scores
      const scores = {};
      sections.forEach(s => scores[s.axis] = 0);

      questions.forEach(q => {
        const val = answers[q.id];
        if (val == null) return;
        const weight = val - 3; // -2..+2
        scores[q.axis] += q.weight * weight;
      });

      drawCompassAnimated(scores.economic || 0, scores.social || 0);
      // Scroll down to the canvas so they see the result
      document.getElementById('compassChart').scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    function drawCompassBase(ctx, canvas) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Quadrants
      ctx.fillStyle = '#fdd';
      ctx.fillRect(0, 0, 250, 250);
      ctx.fillStyle = '#dde5ff';
      ctx.fillRect(250, 0, 250, 250);
      ctx.fillStyle = '#ddf7dd';
      ctx.fillRect(0, 250, 250, 250);
      ctx.fillStyle = '#f5ddf7';
      ctx.fillRect(250, 250, 250, 250);

      // Axes
      ctx.beginPath();
      ctx.moveTo(250, 0);
      ctx.lineTo(250, 500);
      ctx.moveTo(0, 250);
      ctx.lineTo(500, 250);
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 1;
      ctx.stroke();
    }

    function drawDot(ctx, x, y, label) {
      ctx.beginPath();
      ctx.arc(x, y, 8, 0, 2*Math.PI);
      ctx.fillStyle = 'red';
      ctx.shadowColor = 'rgba(255,0,0,.4)';
      ctx.shadowBlur = 10;
      ctx.fill();
      ctx.shadowBlur = 0;

      ctx.font = '14px Arial';
      ctx.fillStyle = '#000';
      ctx.fillText(label, x + 10, y);
    }

    function drawCompassAnimated(scoreX, scoreY) {
      const canvas = document.getElementById('compassChart');
      const ctx = canvas.getContext('2d');
      canvas.classList.remove('hidden');

      // Convert score to pixel (same scale as original: *12)
      const target = {
        x: 250 + (scoreX * 12),
        y: 250 + (scoreY * 12)
      };

      const start = { x: lastPoint.x || 250, y: lastPoint.y || 250 };
      const duration = 700; // ms
      const startTime = performance.now();

      function animate(now) {
        const t = Math.min(1, (now - startTime) / duration);
        // Ease-out cubic
        const e = 1 - Math.pow(1 - t, 3);

        const x = start.x + (target.x - start.x) * e;
        const y = start.y + (target.y - start.y) * e;

        drawCompassBase(ctx, canvas);
        drawDot(ctx, x, y, `(${scoreX}, ${scoreY})`);

        if (t < 1) {
          requestAnimationFrame(animate);
        } else {
          lastPoint = { x: target.x, y: target.y };
        }
      }

      requestAnimationFrame(animate);
    }

    function loadSection() {
      updateProgress();
      renderSection();
    }

    // Kickoff
    window.onload = () => {
      loadSection();
      scrollToTop();
    };
  </script>
</body>
</html>
